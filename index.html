<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Indian Election Analytics</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        /* Professional CSS Styling */
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f6f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); color: white; padding: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-weight: 300; } h1 span { font-weight: 700; }
        .container { display: flex; flex: 1; padding: 20px; gap: 20px; overflow: hidden; }
        .graph-panel { flex: 3; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); padding: 10px; position: relative; }
        .control-panel { flex: 1; background: white; border-radius: 8px; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; margin-top: 5px; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px; color: #7f8c8d; }
    </style>
</head>
<body>

<header>
    <h1>INDIAN <span>ELECTION ANALYTICS</span></h1>
</header>

<div class="container">
    <div class="graph-panel" id="chart">
        <div class="loading" id="loader">Loading Data from GitHub...</div>
    </div>

    <div class="control-panel">
        <div>
            <label>üìç Select Region</label>
            <select id="stateSelect" onchange="updateDashboard()"></select>
        </div>
        <div>
            <label>üìä Select Metric</label>
            <select id="metricSelect" onchange="updateDashboard()">
                <option value="Turnout_Percentage">Voter Turnout (%)</option>
                <option value="Margin_Percentage">Victory Margin (%)</option>
                <option value="N_Cand">Total Candidates</option>
            </select>
        </div>
        <div>
            <label>üé® Chart Type</label>
            <select id="typeSelect" onchange="updateDashboard()">
                <option value="scatter">Trend Line</option>
                <option value="bar">Bar Chart</option>
            </select>
        </div>
    </div>
</div>

<script>
    // GLOBAL DATA VARIABLES
    let rawData = [];
    
    // 1. FETCH DATA FROM CSV
    // This looks for a file named "All_States_GE.csv" in the SAME folder/repo
    Papa.parse("All_States_GE.csv", {
        download: true,
        header: true,
        dynamicTyping: true,
        skipEmptyLines: true,
        complete: function(results) {
            processData(results.data);
        }
    });

    function processData(data) {
        // Filter for Major Elections Only
        const majorYears = [1962, 1967, 1971, 1977, 1980, 1984, 1989, 1991, 1996, 1998, 1999, 2004, 2009, 2014, 2019];
        rawData = data.filter(row => majorYears.includes(row.Year));

        // Populate State Dropdown
        const states = [...new Set(rawData.map(d => d.State_Name))].sort();
        const stateSel = document.getElementById('stateSelect');
        
        // Add "All India" Option
        const optAll = document.createElement('option');
        optAll.value = "All India";
        optAll.innerText = "All India";
        stateSel.appendChild(optAll);

        states.forEach(s => {
            if(s) {
                const opt = document.createElement('option');
                opt.value = s;
                opt.innerText = s.replace(/_/g, " ");
                stateSel.appendChild(opt);
            }
        });

        // Hide Loader and Init
        document.getElementById('loader').style.display = 'none';
        updateDashboard();
    }

    function updateDashboard() {
        const state = document.getElementById('stateSelect').value;
        const metric = document.getElementById('metricSelect').value;
        const type = document.getElementById('typeSelect').value;

        // Filter Data by State
        let filteredData = (state === "All India") ? rawData : rawData.filter(d => d.State_Name === state);

        // Aggregate Data by Year (Mean for %, Sum for Counts)
        const years = [...new Set(filteredData.map(d => d.Year))].sort();
        const yValues = years.map(year => {
            const yearRows = filteredData.filter(d => d.Year === year);
            if (metric === 'N_Cand') {
                return yearRows.length; // Count for candidates
            } else {
                // Average for Percentages
                const sum = yearRows.reduce((a, b) => a + (b[metric] || 0), 0);
                return (sum / yearRows.length).toFixed(1);
            }
        });

        // Plotly Chart
        const trace = {
            x: years,
            y: yValues,
            type: type,
            mode: 'lines+markers',
            marker: { color: '#3498db', size: 8 },
            line: { width: 3, shape: 'spline' }
        };

        const layout = {
            title: state.replace(/_/g, " ") + " - Trend Analysis",
            xaxis: { title: 'Election Year', type: 'category' },
            yaxis: { title: 'Value' },
            margin: { t: 50, l: 50, r: 20, b: 50 }
        };

        Plotly.newPlot('chart', [trace], layout, {responsive: true});
    }
</script>
</body>
</html>
